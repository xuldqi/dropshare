<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Language Debug - DropShare</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-title {
            color: #333;
            border-bottom: 2px solid #3367d6;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .debug-item {
            margin: 10px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .debug-label {
            font-weight: bold;
            color: #555;
        }
        .debug-value {
            color: #333;
            font-family: monospace;
        }
        .button {
            background: #3367d6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #2563eb;
        }
        .button.danger {
            background: #ef4444;
        }
        .button.danger:hover {
            background: #dc2626;
        }
    </style>
</head>
<body>
    <h1>DropShare è¯­è¨€è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-section">
        <h2 class="debug-title">å½“å‰è¯­è¨€è®¾ç½®çŠ¶æ€</h2>
        <div class="debug-item">
            <span class="debug-label">æµè§ˆå™¨è¯­è¨€:</span>
            <span class="debug-value" id="browserLang">-</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">localStorage ä¸­ä¿å­˜çš„è¯­è¨€:</span>
            <span class="debug-value" id="savedLang">-</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">å½“å‰ä½¿ç”¨çš„è¯­è¨€:</span>
            <span class="debug-value" id="currentLang">-</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">æ£€æµ‹åˆ°çš„è¯­è¨€ä»£ç :</span>
            <span class="debug-value" id="detectedLang">-</span>
        </div>
    </div>

    <div class="debug-section">
        <h2 class="debug-title">é—®é¢˜è¯Šæ–­</h2>
        <div id="diagnosis">æ­£åœ¨åˆ†æ...</div>
    </div>

    <div class="debug-section">
        <h2 class="debug-title">è§£å†³æ–¹æ¡ˆ</h2>
        <button class="button danger" onclick="clearLanguageStorage()">æ¸…é™¤è¯­è¨€è®¾ç½® (é‡ç½®ä¸ºæµè§ˆå™¨é»˜è®¤)</button>
        <button class="button" onclick="setLanguage('zh')">è®¾ç½®ä¸ºä¸­æ–‡</button>
        <button class="button" onclick="setLanguage('en')">è®¾ç½®ä¸ºè‹±æ–‡</button>
        <button class="button" onclick="setLanguage('ja')">è®¾ç½®ä¸ºæ—¥è¯­</button>
        <button class="button" onclick="refreshDebug()">åˆ·æ–°è°ƒè¯•ä¿¡æ¯</button>
    </div>

    <div class="debug-section">
        <h2 class="debug-title">æ“ä½œç»“æœ</h2>
        <div id="results"></div>
    </div>

    <script>
        function getBrowserLanguage() {
            return navigator.language || navigator.userLanguage || 'unknown';
        }

        function getSavedLanguage() {
            try {
                return localStorage.getItem('dropshare_language') || 'none';
            } catch (e) {
                return 'error';
            }
        }

        function detectLanguage() {
            const browserLang = getBrowserLanguage();
            const langCode = browserLang.toLowerCase();
            
            // ç®€åŒ–çš„è¯­è¨€æ£€æµ‹é€»è¾‘
            if (langCode.startsWith('zh')) {
                if (langCode.includes('tw') || langCode.includes('hk')) {
                    return 'zh-tw';
                }
                return 'zh';
            }
            if (langCode.startsWith('ja')) return 'ja';
            if (langCode.startsWith('ko')) return 'ko';
            if (langCode.startsWith('ar')) return 'ar';
            if (langCode.startsWith('ru')) return 'ru';
            if (langCode.startsWith('fr')) return 'fr';
            if (langCode.startsWith('de')) return 'de';
            if (langCode.startsWith('es')) return 'es';
            if (langCode.startsWith('pt')) return 'pt';
            
            return 'en'; // é»˜è®¤è‹±æ–‡
        }

        function updateDebugInfo() {
            const browserLang = getBrowserLanguage();
            const savedLang = getSavedLanguage();
            const detectedLang = detectLanguage();
            const currentLang = savedLang !== 'none' ? savedLang : detectedLang;

            document.getElementById('browserLang').textContent = browserLang;
            document.getElementById('savedLang').textContent = savedLang;
            document.getElementById('detectedLang').textContent = detectedLang;
            document.getElementById('currentLang').textContent = currentLang;

            // è¯Šæ–­é—®é¢˜
            let diagnosis = '';
            if (savedLang === 'ja' && !browserLang.startsWith('ja')) {
                diagnosis += 'âŒ æ£€æµ‹åˆ°é—®é¢˜: localStorage ä¸­ä¿å­˜äº†æ—¥è¯­è®¾ç½®ï¼Œä½†æ‚¨çš„æµè§ˆå™¨è¯­è¨€ä¸æ˜¯æ—¥è¯­ã€‚<br>';
                diagnosis += 'ğŸ“ å»ºè®®: ç‚¹å‡»"æ¸…é™¤è¯­è¨€è®¾ç½®"æŒ‰é’®é‡ç½®ä¸ºæµè§ˆå™¨é»˜è®¤è¯­è¨€ã€‚<br>';
            } else if (savedLang === 'none') {
                diagnosis += 'âœ… æ²¡æœ‰ä¿å­˜çš„è¯­è¨€è®¾ç½®ï¼Œå°†ä½¿ç”¨æµè§ˆå™¨æ£€æµ‹ç»“æœã€‚<br>';
            } else {
                diagnosis += 'ğŸ“„ ä½¿ç”¨å·²ä¿å­˜çš„è¯­è¨€è®¾ç½®: ' + savedLang + '<br>';
            }

            if (browserLang.startsWith('zh')) {
                diagnosis += 'ğŸŒ æ£€æµ‹åˆ°ä¸­æ–‡æµè§ˆå™¨ï¼Œå»ºè®®è¯­è¨€: ä¸­æ–‡ (zh)<br>';
            }

            document.getElementById('diagnosis').innerHTML = diagnosis;
        }

        function clearLanguageStorage() {
            try {
                localStorage.removeItem('dropshare_language');
                logResult('âœ… å·²æ¸…é™¤è¯­è¨€è®¾ç½®ï¼Œé¡µé¢å°†ä½¿ç”¨æµè§ˆå™¨é»˜è®¤è¯­è¨€');
                updateDebugInfo();
            } catch (e) {
                logResult('âŒ æ¸…é™¤å¤±è´¥: ' + e.message);
            }
        }

        function setLanguage(lang) {
            try {
                localStorage.setItem('dropshare_language', lang);
                logResult('âœ… å·²è®¾ç½®è¯­è¨€ä¸º: ' + lang);
                updateDebugInfo();
            } catch (e) {
                logResult('âŒ è®¾ç½®å¤±è´¥: ' + e.message);
            }
        }

        function refreshDebug() {
            updateDebugInfo();
            logResult('ğŸ”„ è°ƒè¯•ä¿¡æ¯å·²åˆ·æ–°');
        }

        function logResult(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML = `[${timestamp}] ${message}<br>` + results.innerHTML;
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°è°ƒè¯•ä¿¡æ¯
        updateDebugInfo();
    </script>
</body>
</html>