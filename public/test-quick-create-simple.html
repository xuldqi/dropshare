<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>快速创建测试 - 简化版</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            padding: 12px 24px;
            margin: 8px;
            border: none;
            border-radius: 6px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        button:hover { background: #0056b3; transform: translateY(-1px); }
        button.success { background: #28a745; }
        button.danger { background: #dc3545; }
        button.warning { background: #ffc107; color: #212529; }
        #log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.4;
            border-radius: 6px;
        }
        .quick-create-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
            font-weight: 600;
            font-size: 16px;
            padding: 15px 30px;
        }
        .quick-create-btn:hover {
            background: linear-gradient(135deg, #0e8074 0%, #2dd65a 100%);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 快速创建房间功能测试</h1>
        
        <div class="test-section">
            <h3>📡 网络状态检查</h3>
            <div id="networkStatus" class="status info">正在检查网络状态...</div>
            <button onclick="checkNetworkStatus()">🔄 重新检查网络</button>
            <button onclick="initNetwork()">🔧 初始化网络</button>
        </div>
        
        <div class="test-section">
            <h3>⚡ 快速创建测试</h3>
            <button id="testQuickCreate" class="quick-create-btn" onclick="testQuickCreate()">🚀 快速创建房间</button>
            <button class="success" onclick="testDirectFunction()">🎯 直接调用函数</button>
            <button class="warning" onclick="simulateClick()">🖱️ 模拟点击</button>
        </div>
        
        <div class="test-section">
            <h3>📋 调试日志</h3>
            <button class="danger" onclick="clearLog()">🗑️ 清空日志</button>
            <button onclick="exportLog()">💾 导出日志</button>
            <div id="log"></div>
        </div>
    </div>
    
    <script>
        let logCount = 0;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logCount++;
            
            const typeIcon = {
                'info': 'ℹ️',
                'success': '✅',
                'error': '❌',
                'warning': '⚠️',
                'debug': '🔧'
            };
            
            const color = {
                'info': '#17a2b8',
                'success': '#28a745',
                'error': '#dc3545',
                'warning': '#ffc107',
                'debug': '#6f42c1'
            };
            
            logDiv.innerHTML += `<div style="color: ${color[type]}; margin: 2px 0;">[${logCount.toString().padStart(3, '0')}] [${timestamp}] ${typeIcon[type]} ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            logCount = 0;
            log('日志已清空', 'info');
        }
        
        function exportLog() {
            const logContent = document.getElementById('log').innerText;
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `quick-create-test-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.log`;
            a.click();
            URL.revokeObjectURL(url);
            log('日志已导出', 'success');
        }
        
        // 简化的网络对象模拟
        window.network = {
            isConnected: false,
            send: function(message) {
                log('📤 发送消息: ' + JSON.stringify(message, null, 2), 'info');
                if (!this.isConnected) {
                    throw new Error('网络未连接');
                }
                // 模拟成功发送
                setTimeout(() => {
                    log('✅ 消息发送成功', 'success');
                }, 100);
            },
            connect: function() {
                log('🔌 正在连接网络...', 'info');
                setTimeout(() => {
                    this.isConnected = true;
                    log('✅ 网络连接成功', 'success');
                    updateNetworkStatus();
                }, 1000);
            }
        };
        
        function initNetwork() {
            log('🔧 初始化网络连接', 'debug');
            window.network.connect();
        }
        
        function updateNetworkStatus() {
            const statusDiv = document.getElementById('networkStatus');
            if (window.network && window.network.isConnected) {
                statusDiv.className = 'status success';
                statusDiv.textContent = '✅ 网络已连接，可以发送消息';
            } else {
                statusDiv.className = 'status warning';
                statusDiv.textContent = '⚠️ 网络未连接';
            }
        }
        
        function checkNetworkStatus() {
            log('🔍 检查网络状态...', 'debug');
            
            const statusDiv = document.getElementById('networkStatus');
            
            // 检查 window.network 对象
            if (!window.network) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '❌ window.network 对象不存在';
                log('❌ window.network 对象不存在', 'error');
                return;
            }
            
            log('✅ window.network 对象存在', 'success');
            
            // 检查 send 方法
            if (!window.network.send) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '❌ window.network.send 方法不存在';
                log('❌ window.network.send 方法不存在', 'error');
                return;
            }
            
            log('✅ window.network.send 方法存在', 'success');
            
            // 检查连接状态
            updateNetworkStatus();
        }
        
        function handleQuickCreateRoom() {
            log('🔵 快速创建房间函数被调用', 'info');
            
            // 检查网络连接
            if (!window.network || !window.network.send) {
                log('❌ 网络连接不可用，请刷新页面重试', 'error');
                return;
            }
            
            if (!window.network.isConnected) {
                log('❌ 网络未连接，请先初始化网络', 'error');
                return;
            }
            
            // 生成随机房间名称
            const adjectives = ['快乐', '温馨', '舒适', '明亮', '安静', '友好', '活跃', '创意', '神秘', '梦幻'];
            const nouns = ['房间', '空间', '聚会', '会议', '工作室', '咖啡厅', '书房', '客厅', '花园', '天地'];
            const randomAdjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
            const roomName = randomAdjective + randomNoun;
            
            // 生成房间代码
            const roomCode = Math.random().toString(36).substr(2, 8).toUpperCase();
            
            const message = {
                type: 'create-room',
                roomSettings: {
                    code: roomCode,
                    name: roomName,
                    password: undefined,
                    maxMembers: 10,
                    isPrivate: false
                }
            };
            
            log('📤 发送快速创建房间消息:', 'info');
            log(JSON.stringify(message, null, 2), 'debug');
            
            try {
                window.network.send(message);
                log('✅ 正在创建房间: ' + roomName, 'success');
            } catch (error) {
                log('❌ 发送快速创建房间消息失败: ' + error.message, 'error');
            }
        }
        
        function testQuickCreate() {
            log('🧪 开始测试快速创建功能...', 'info');
            
            try {
                handleQuickCreateRoom();
                log('✅ 快速创建测试完成', 'success');
            } catch (error) {
                log('❌ 快速创建测试失败: ' + error.message, 'error');
            }
        }
        
        function testDirectFunction() {
            log('🎯 直接测试快速创建逻辑...', 'info');
            
            try {
                if (typeof handleQuickCreateRoom === 'function') {
                    log('✅ handleQuickCreateRoom 函数存在', 'success');
                    handleQuickCreateRoom();
                } else {
                    log('❌ handleQuickCreateRoom 函数不存在', 'error');
                }
            } catch (error) {
                log('❌ 直接调用失败: ' + error.message, 'error');
            }
        }
        
        function simulateClick() {
            log('🖱️ 模拟点击快速创建按钮...', 'info');
            
            const btn = document.getElementById('testQuickCreate');
            if (btn) {
                try {
                    btn.click();
                    log('✅ 模拟点击成功', 'success');
                } catch (error) {
                    log('❌ 模拟点击失败: ' + error.message, 'error');
                }
            } else {
                log('❌ 找不到快速创建按钮', 'error');
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            log('📄 页面加载完成', 'info');
            
            // 延迟检查网络状态
            setTimeout(() => {
                checkNetworkStatus();
            }, 500);
            
            log('🎉 快速创建测试页面初始化完成', 'success');
        });
    </script>
</body>
</html>