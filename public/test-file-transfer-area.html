<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶ä¼ è¾“åŒºåŸŸæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .log-area {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        /* å¤åˆ¶ share.html ä¸­çš„æ–‡ä»¶ä¼ è¾“åŒºåŸŸæ ·å¼ */
        .file-transfer-area {
            display: none;
            width: 100%;
            margin-top: 24px;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 20px;
        }
        
        .file-transfer-area.active {
            display: block;
        }
        
        .room-file-sharing {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .shared-files-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .shared-files-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .shared-files-list {
            min-height: 100px;
            border: 1px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: #666;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-hidden { background: #dc3545; }
        .status-visible { background: #28a745; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ–‡ä»¶ä¼ è¾“åŒºåŸŸæ˜¾ç¤ºæµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
            <div id="statusDisplay">
                <div>æ–‡ä»¶ä¼ è¾“åŒºåŸŸçŠ¶æ€: <span class="status-indicator status-hidden"></span><span id="areaStatus">æ£€æŸ¥ä¸­...</span></div>
                <div>Display æ ·å¼: <span id="displayStyle">-</span></div>
                <div>Active ç±»: <span id="activeClass">-</span></div>
                <div>å¯è§æ€§: <span id="visibility">-</span></div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ›ï¸ æµ‹è¯•æ§åˆ¶</h3>
            <button class="test-button" onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
            <button class="test-button" onclick="showArea()">æ˜¾ç¤ºåŒºåŸŸ</button>
            <button class="test-button" onclick="hideArea()">éšè—åŒºåŸŸ</button>
            <button class="test-button" onclick="toggleArea()">åˆ‡æ¢æ˜¾ç¤º</button>
            <button class="test-button" onclick="simulateRoomJoin()">æ¨¡æ‹ŸåŠ å…¥æˆ¿é—´</button>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
            <div id="logArea" class="log-area"></div>
        </div>
        
        <!-- æ–‡ä»¶ä¼ è¾“åŒºåŸŸ -->
        <div id="fileTransferArea" class="file-transfer-area">
            <div class="room-file-sharing">
                <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-section">
                    <h3>ğŸ“¤ ä¸Šä¼ æ–‡ä»¶åˆ°æˆ¿é—´</h3>
                    <div style="text-align: center; padding: 10px;">
                        <button type="button" id="selectFilesBtn" style="cursor: pointer; display: inline-block; padding: 12px 24px; background: #4285f4; color: white; border-radius: 6px; text-align: center; user-select: none; border: none; font-family: inherit; font-weight: 600; font-size: 14px;">é€‰æ‹©æ–‡ä»¶ä¸Šä¼ </button>
                        <input type="file" id="fileInput" multiple style="display: none;">
                    </div>
                </div>
                
                <!-- å…±äº«æ–‡ä»¶åˆ—è¡¨ -->
                <div class="shared-files-section">
                    <div class="shared-files-header">
                        <h3>ğŸ“ æˆ¿é—´å…±äº«æ–‡ä»¶</h3>
                        <span class="file-count" id="fileCount">0 <span>ä¸ªæ–‡ä»¶</span></span>
                    </div>
                    <div id="sharedFilesList" class="shared-files-list">
                        <div class="no-shared-files">
                            <p>æˆ¿é—´å†…æš‚æ— å…±äº«æ–‡ä»¶</p>
                            <p class="hint">ä¸Šä¼ æ–‡ä»¶åï¼Œæ‰€æœ‰æˆ¿é—´æˆå‘˜éƒ½å¯ä»¥ä¸‹è½½</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }
        
        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
        }
        
        // æ£€æŸ¥æ–‡ä»¶ä¼ è¾“åŒºåŸŸçŠ¶æ€
        function checkStatus() {
            const area = document.getElementById('fileTransferArea');
            
            if (!area) {
                log('âŒ fileTransferArea å…ƒç´ ä¸å­˜åœ¨');
                return;
            }
            
            const computedStyle = window.getComputedStyle(area);
            const hasActiveClass = area.classList.contains('active');
            const isVisible = computedStyle.display !== 'none';
            
            log('ğŸ“Š æ–‡ä»¶ä¼ è¾“åŒºåŸŸçŠ¶æ€æ£€æŸ¥:');
            log(`- å…ƒç´ å­˜åœ¨: ${!!area}`);
            log(`- display æ ·å¼: ${computedStyle.display}`);
            log(`- visibility æ ·å¼: ${computedStyle.visibility}`);
            log(`- opacity æ ·å¼: ${computedStyle.opacity}`);
            log(`- æ˜¯å¦æœ‰ active ç±»: ${hasActiveClass}`);
            log(`- æ‰€æœ‰ç±»å: ${area.className}`);
            log(`- å†…è”æ ·å¼: ${area.style.cssText}`);
            log(`- æ˜¯å¦å¯è§: ${isVisible}`);
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay();
            
            return { area, hasActiveClass, isVisible };
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            const area = document.getElementById('fileTransferArea');
            const computedStyle = window.getComputedStyle(area);
            const hasActiveClass = area.classList.contains('active');
            const isVisible = computedStyle.display !== 'none';
            
            document.getElementById('areaStatus').textContent = isVisible ? 'å¯è§' : 'éšè—';
            document.getElementById('displayStyle').textContent = computedStyle.display;
            document.getElementById('activeClass').textContent = hasActiveClass ? 'æ˜¯' : 'å¦';
            document.getElementById('visibility').textContent = computedStyle.visibility;
            
            // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
            const indicator = document.querySelector('.status-indicator');
            indicator.className = `status-indicator ${isVisible ? 'status-visible' : 'status-hidden'}`;
        }
        
        // æ˜¾ç¤ºæ–‡ä»¶ä¼ è¾“åŒºåŸŸ
        function showArea() {
            const area = document.getElementById('fileTransferArea');
            
            if (area) {
                log('ğŸ”§ æ˜¾ç¤ºæ–‡ä»¶ä¼ è¾“åŒºåŸŸ...');
                
                // æ·»åŠ  active ç±»
                area.classList.add('active');
                
                // è®¾ç½®å†…è”æ ·å¼ç¡®ä¿æ˜¾ç¤º
                area.style.display = 'block';
                area.style.visibility = 'visible';
                area.style.opacity = '1';
                
                log('âœ… å·²æ˜¾ç¤ºæ–‡ä»¶ä¼ è¾“åŒºåŸŸ');
                
                // æ›´æ–°çŠ¶æ€
                setTimeout(updateStatusDisplay, 100);
            }
        }
        
        // éšè—æ–‡ä»¶ä¼ è¾“åŒºåŸŸ
        function hideArea() {
            const area = document.getElementById('fileTransferArea');
            
            if (area) {
                log('ğŸ”§ éšè—æ–‡ä»¶ä¼ è¾“åŒºåŸŸ...');
                
                // ç§»é™¤ active ç±»
                area.classList.remove('active');
                
                // æ¸…é™¤å†…è”æ ·å¼
                area.style.display = '';
                area.style.visibility = '';
                area.style.opacity = '';
                
                log('âŒ å·²éšè—æ–‡ä»¶ä¼ è¾“åŒºåŸŸ');
                
                // æ›´æ–°çŠ¶æ€
                setTimeout(updateStatusDisplay, 100);
            }
        }
        
        // åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€
        function toggleArea() {
            const area = document.getElementById('fileTransferArea');
            const isVisible = window.getComputedStyle(area).display !== 'none';
            
            if (isVisible) {
                hideArea();
            } else {
                showArea();
            }
        }
        
        // æ¨¡æ‹ŸåŠ å…¥æˆ¿é—´
        function simulateRoomJoin() {
            log('ğŸ  æ¨¡æ‹ŸåŠ å…¥æˆ¿é—´...');
            
            // æ¨¡æ‹Ÿ onRoomJoined æ–¹æ³•ä¸­çš„é€»è¾‘
            setTimeout(() => {
                log('ğŸ“¡ æ”¶åˆ° room-joined æ¶ˆæ¯');
                
                // è°ƒç”¨æ˜¾ç¤ºæ–‡ä»¶ä¼ è¾“åŒºåŸŸ
                showFileTransferArea();
                
                log('âœ… æˆ¿é—´åŠ å…¥å®Œæˆ');
            }, 500);
        }
        
        // æ¨¡æ‹Ÿ share.html ä¸­çš„ showFileTransferArea æ–¹æ³•
        function showFileTransferArea() {
            const fileTransferArea = document.getElementById('fileTransferArea');
            if (fileTransferArea) {
                fileTransferArea.classList.add('active');
                fileTransferArea.style.display = 'block';
                log('âœ… File transfer area activated via showFileTransferArea');
                
                // æ›´æ–°çŠ¶æ€
                setTimeout(updateStatusDisplay, 100);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ æ–‡ä»¶ä¼ è¾“åŒºåŸŸæµ‹è¯•é¡µé¢å·²åŠ è½½');
            checkStatus();
        });
        
        // å®šæœŸæ›´æ–°çŠ¶æ€æ˜¾ç¤º
        setInterval(updateStatusDisplay, 2000);
    </script>
</body>
</html>