<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- Web App Config -->
    <title>DropShare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3367d6">
    <meta name="color-scheme" content="dark light">
    <meta name="apple-mobile-web-app-capable" content="no">
    <meta name="apple-mobile-web-app-title" content="DropShare">
    <!-- Descriptions -->
    <meta name="description" content="Instantly share images, videos, PDFs, and links with people nearby. Peer2Peer and Open Source. No Setup, No Signup.">
    <meta name="keywords" content="File, Transfer, Share, Peer2Peer">
    <meta name="author" content="RobinLinus">
    <meta property="og:title" content="DropShare">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://snapdrop.net/">
    <meta property="og:author" content="https://facebook.com/RobinLinus">
    <meta name="twitter:author" content="@RobinLinus">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="Instantly share images, videos, PDFs, and links with people nearby. Peer2Peer and Open Source. No Setup, No Signup.">
    <meta name="og:description" content="Instantly share images, videos, PDFs, and links with people nearby. Peer2Peer and Open Source. No Setup, No Signup.">
    <!-- Icons -->
    <link rel="icon" sizes="96x96" href="images/favicon-96x96.png">
    <link rel="shortcut icon" href="images/favicon-96x96.png">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <meta name="msapplication-TileImage" content="images/mstile-150x150.png">
    <link rel="fluid-icon" type="image/png" href="images/android-chrome-192x192.png">
    <meta name="twitter:image" content="https://snapdrop.net/images/twitter-stream.jpg">
    <meta property="og:image" content="https://snapdrop.net/images/twitter-stream.jpg">
    <!-- Resources -->
    <link rel="stylesheet" type="text/css" href="styles.css">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4803558716082981" 
            crossorigin="anonymous"></script>
    
    <!-- Internationalization -->
    <script src="locales/i18n.js"></script>
    
    <link rel="manifest" href="manifest.json">
    
    <style>
        /* Unified Header Styles */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e5e7eb;
            z-index: 1000;
            padding: 12px 0;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        
        .brand-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Hamburger (hidden on desktop) */
        .hamburger {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .hamburger span {
            display: block;
            width: 20px;
            height: 2px;
            background: #374151;
            position: relative;
            transition: all 0.3s ease;
        }

        .hamburger span::before,
        .hamburger span::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: #374151;
            transition: all 0.3s ease;
        }

        .hamburger span::before { top: -6px; }
        .hamburger span::after { top: 6px; }

        .menu-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .menu-backdrop.show { display: block; }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: bold;
            color: #2563eb;
        }

        .logo svg {
            width: 32px;
            height: 32px;
            fill: #2563eb;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-links {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .nav-links a {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .nav-links a:hover {
            color: #3367d6;
            background: #f3f4f6;
        }

        .nav-links a.active {
            color: #3367d6;
            background: #e3f2fd;
            font-weight: 600;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .icon-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid #e5e7eb;
            color: #6b7280;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .icon-button:hover {
            background: #f3f4f6;
            color: #3367d6;
            border-color: #d1d5db;
        }

        .icon-button .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Override styles.css layout for centered sharing page */
        body {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: flex-start !important;
            min-height: 100vh !important;
            overflow-y: auto !important;
        }
        
        /* Main page container */
        .page-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            min-height: 100vh;
            position: relative;
            padding-top: 80px;
        }
        
        /* Message area in the center */
        .center-message {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 24px;
            min-height: calc(100vh - 120px);
            overflow: visible;
        }
        
        /* User info at bottom */
        .user-info-bottom {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .user-info-bottom footer {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .user-info-bottom .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .user-info-bottom .text-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        /* Style the peer area */
        x-peers {
            display: flex !important;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        
        /* Center the no-peers message */
        x-no-peers {
            margin: 20px 0;
        }
        
        /* Center footer content */
        footer {
            position: static !important;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        
        /* Hide instructions container that interferes */
        .instructions-container {
            display: none;
        }
        
        /* Hide back to home button */
        .back-home-btn {
            display: none !important;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }
            
            .nav-links {
                position: fixed;
                top: 0;
                right: -100%;
                width: 280px;
                height: 100vh;
                background: white;
                flex-direction: column;
                padding: 80px 24px 24px;
                gap: 8px;
                transition: right 0.3s ease;
                z-index: 1001;
                box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            }
            
            .nav-links.mobile-open {
                right: 0;
            }
            
            .nav-links a {
                width: 100%;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 16px;
            }
            
            .header-container {
                padding: 0 16px;
            }
            
            .center-message {
                padding: 20px 16px;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .header {
                background: rgba(17, 24, 39, 0.95);
                border-bottom-color: #374151;
            }
            
            .hamburger span,
            .hamburger span::before,
            .hamburger span::after {
                background: #d1d5db;
            }
            
            .logo {
                color: #60a5fa;
            }
            
            .logo svg {
                fill: #60a5fa;
            }
            
            .nav-links {
                background: #111827;
            }
            
            .nav-links a {
                color: #d1d5db;
            }
            
            .nav-links a:hover {
                color: #60a5fa;
                background: #374151;
            }
            
            .nav-links a.active {
                color: #60a5fa;
                background: #1e3a8a;
            }
            
            .icon-button {
                border-color: #374151;
                color: #d1d5db;
            }
            
            .icon-button:hover {
                background: #374151;
                color: #60a5fa;
                border-color: #4b5563;
            }
        }
    </style>
</head>

<body>
    <!-- Unified Header -->
    <header class="header">
        <div class="header-container">
            <div class="header-controls">
                <div class="brand-left">
                    <!-- Mobile Hamburger -->
                    <button class="hamburger" id="hamburgerBtn" aria-label="Open Menu">
                        <span></span>
                    </button>
                    <!-- Logo -->
                    <div class="logo">
                        <svg class="icon">
                            <use xlink:href="#wifi-tethering" />
                        </svg>
                        <span>DropShare</span>
                    </div>
                </div>
                
                <!-- Navigation Links -->
                <nav class="nav-links" id="mobileNavLinks">
                    <a href="index.html" data-i18n="nav_home">Home</a>
                    <a href="share-clean.html" class="active" data-i18n="nav_transfer">Transfer</a>
                    <a href="image-tools.html" data-i18n="nav_images">Images</a>
                    <a href="audio-tools.html" data-i18n="nav_audio">Audio</a>
                    <a href="video-tools.html" data-i18n="nav_video">Video</a>
                    <a href="document-tools.html" data-i18n="nav_files">Files</a>
                </nav>
                
                <div class="control-buttons">
                    <!-- Language Selector -->
                    <select id="languageSelector" class="icon-button" style="width: auto; padding: 0 8px; font-size: 12px;">
                        <option value="en">English</option>
                        <option value="zh-CN">简体中文</option>
                        <option value="zh-TW">繁體中文</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                        <option value="es">Español</option>
                        <option value="fr">Français</option>
                        <option value="de">Deutsch</option>
                        <option value="pt">Português</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu Backdrop -->
        <div class="menu-backdrop" id="menuBackdrop"></div>
    </header>

    <!-- Main Content -->
    <div class="page-container">
        <div class="center-message">
            <!-- Device Discovery Area -->
            <div id="peerContainer">
                <x-peers class="center"></x-peers>
                <x-no-peers>
                    <h2 data-i18n="share_open_dropshare_other_devices">Open DropShare on other devices to send files</h2>
                </x-no-peers>
            </div>
        </div>
        
        <!-- User info at bottom -->
        <div class="user-info-bottom" id="userInfoBottom">
            <footer>
                <div class="logo-container">
                    <svg class="icon logo">
                        <use xlink:href="#wifi-tethering" />
                    </svg>
                </div>
                <div class="text-container">
                    <div id="displayName" class="text-line"></div>
                    <div class="font-body2 text-line" data-i18n="share_discoverable_network">You can be discovered by everyone on this network</div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Receive Dialog -->
    <x-dialog id="receiveDialog">
        <x-background class="full center">
            <x-paper shadow="2">
                <h3 data-i18n="share_file_received">File Received</h3>
                <div class="font-subheading" id="fileName"></div>
                <div class="font-body2" id="fileSize"></div>
                <div class='preview' style="visibility: hidden;">
                    <img id='img-preview' src="">
                </div>
                <div class="row">
                    <label for="autoDownload" class="grow" data-i18n="share_ask_save_before_download">Ask to save each file before downloading</label>
                    <input type="checkbox" id="autoDownload" checked="">
                </div>
                <div class="row-reverse">
                    <a class="button" close id="download" title="Download File" autofocus data-i18n="share_save">Save</a>
                    <button class="button" close data-i18n="share_ignore">Ignore</button>
                </div>
            </x-paper>
        </x-background>
    </x-dialog>
    
    <!-- Send Text Dialog -->
    <x-dialog id="sendTextDialog">
        <form action="#">
            <x-background class="full center">
                <x-paper shadow="2">
                    <h3 data-i18n="share_send_message">Send a Message</h3>
                    <div id="textInput" class="textarea" role="textbox" data-i18n-placeholder="share_send_message_placeholder" data-placeholder="Send a message" autocomplete="off" autofocus contenteditable></div>
                    <div class="row-reverse">
                        <button class="button" type="submit" close data-i18n="share_send">Send</button>
                        <a class="button" close data-i18n="share_cancel">Cancel</a>
                    </div>
                </x-paper>
            </x-background>
        </form>
    </x-dialog>
    
    <!-- Receive Text Dialog -->
    <x-dialog id="receiveTextDialog">
        <x-background class="full center">
            <x-paper shadow="2">
                <h3 data-i18n="share_message_received">Message Received</h3>
                <div class="font-subheading" id="text"></div>
                <div class="row-reverse">
                    <button class="button" id="copy" close autofocus data-i18n="share_copy">Copy</button>
                    <button class="button" close data-i18n="share_close">Close</button>
                </div>
            </x-paper>
        </x-background>
    </x-dialog>
    
    <!-- Toast -->
    <div class="toast-container full center">
        <x-toast class="row" shadow="1" id="toast">
            <span id="toast-text">Notification</span>
        </x-toast>
    </div>
    
    <!-- About Page -->
    <x-about id="about" class="full center column" style="display: none;">
        <section class="center column fade-in">
            <header class="row-reverse">
                <a href="#" class="close icon-button">
                    <svg class="icon">
                        <use xlink:href="#close" />
                    </svg>
                </a>
            </header>
            <svg class="icon logo">
                <use xlink:href="#wifi-tethering" />
            </svg>
            <h1>DropShare</h1>
            <div class="font-subheading"><span data-i18n="share_easiest_way_transfer">The easiest way to transfer files across devices</span><div style="font-size:10px;"><span data-i18n="share_modified_version_by">Modified version by</span> <a href="#" target="_blank">YourNameHere</a></div></div>
            <div class="row">
                <a class="icon-button" target="_blank" href="#" title="DropShare on Github" rel="noreferrer">
                    <svg class="icon">
                        <use xlink:href="#github" />
                    </svg>
                </a>
                <a class="icon-button" target="_blank" href="#" title="Help cover the server costs!" rel="noreferrer">
                    <svg class="icon">
                        <use xlink:href="#monetarization" />
                    </svg>
                </a>
                <a class="icon-button" target="_blank" href="#" title="Tweet about DropShare" rel="noreferrer">
                    <svg class="icon">
                        <use xlink:href="#twitter" />
                    </svg>
                </a>
                <a class="icon-button" target="_blank" href="#" title="Frequently asked questions" rel="noreferrer">
                    <svg class="icon">
                        <use xlink:href="#help-outline" />
                    </svg>
                </a>
            </div>
        </section>
        <x-background></x-background>
    </x-about>
    
    <!-- SVG Icon Library -->
    <svg style="display: none;">
        <symbol id="wifi-tethering" viewBox="0 0 24 24">
            <path d="M12 11c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 2c0-3.31-2.69-6-6-6s-6 2.69-6 6c0 2.22 1.21 4.15 3 5.19l1-1.74c-1.19-.7-2-1.97-2-3.45 0-2.21 1.79-4 4-4s4 1.79 4 4c0 1.48-.81 2.75-2 3.45l1 1.74c1.79-1.04 3-2.97 3-5.19zM12 3C6.48 3 2 7.48 2 13c0 3.7 2.01 6.92 4.99 8.65l1-1.73C5.61 18.53 4 15.96 4 13c0-4.42 3.58-8 8-8s8 3.58 8 8c0 2.96-1.61 5.53-4 6.92l1 1.73c2.99-1.73 5-4.95 5-8.65 0-5.52-4.48-10-10-10z"></path>
        </symbol>
        <symbol id="desktop-mac" viewBox="0 0 24 24">
            <path d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7l-2 3v1h8v-1l-2-3h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 12H3V4h18v10z"></path>
        </symbol>
        <symbol id="phone-iphone" viewBox="0 0 24 24">
            <path d="M15.5 1h-8C6.12 1 5 2.12 5 3.5v17C5 21.88 6.12 23 7.5 23h8c1.38 0 2.5-1.12 2.5-2.5v-17C18 2.12 16.88 1 15.5 1zm-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5-4H7V4h9v14z"></path>
        </symbol>
        <symbol id="phone-android" viewBox="0 0 24 24">
            <path d="M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"></path>
        </symbol>
        <symbol id="tablet-mac" viewBox="0 0 24 24">
            <path d="M18.5 0h-14C3.12 0 2 1.12 2 2.5v19C2 22.88 3.12 24 4.5 24h14c1.38 0 2.5-1.12 2.5-2.5v-19C21 1.12 19.88 0 18.5 0zm-7 23c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm7.5-4H4V3h15v16z"></path>
        </symbol>
        <symbol id="tablet-android" viewBox="0 0 24 24">
            <path d="M18 0H6C4.34 0 3 1.34 3 3v18c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V3c0-1.66-1.34-3-3-3zm-4 22h-4v-1h4v1zm5.25-3H4.75V3h14.5v16z"></path>
        </symbol>
        <symbol id="close" viewBox="0 0 24 24">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
        </symbol>
        <symbol id="help-outline" viewBox="0 0 24 24">
            <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"></path>
        </symbol>
        <symbol id="twitter">
            <path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z" />
        </symbol>
        <symbol id="github">
            <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" />
        </symbol>
        <symbol id="monetarization" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/>
        </symbol>
        <symbol id="icon-theme" viewBox="0 0 24 24"><rect fill="none" height="24" width="24"/><path d="M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36c-0.98,1.37-2.58,2.26-4.4,2.26 c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></symbol>
        
        <!-- Add the sun icon for light mode -->
        <symbol id="icon-sun" viewBox="0 0 24 24"><rect fill="none" height="24" width="24"/><path d="M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0 c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2 c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1 S11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0 s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06 c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41 c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36 c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z" /></symbol>
    </svg>
    
    <!-- Sounds -->
    <audio id="blop" autobuffer="true">
        <source src="/sounds/blop.mp3" type="audio/mpeg">
        <source src="/sounds/blop.ogg" type="audio/ogg">
    </audio>
    
    <!-- no script -->
    <noscript>
        <x-noscript class="full center column">
            <h1 data-i18n="share_enable_javascript">Enable JavaScript</h1>
            <h3 data-i18n="share_javascript_required">DropShare works only with JavaScript</h3>
        </x-noscript>
        <style>
        x-noscript {
            background: #599cfc;
            color: white;
            z-index: 2;
        }

        a[href="#info"] {
            color: white;
        }
        </style>
    </noscript>
    
    <!-- Scripts -->
    <script src="./security_utils.js"></script>
    <script src="scripts/network.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/clipboard.js" async></script>
    
    <!-- Device name display script - 使用服务器发送的设备名称 -->
    <script>
    (function() {
        console.log('🔧 初始化设备名称显示...');
        
        let serverDisplayName = null;
        let hasReceivedServerName = false;
        
        function updateDisplayName(displayName, deviceName) {
            const displayNameEl = document.getElementById('displayName');
            if (!displayNameEl) {
                console.log('❌ 找不到displayName元素');
                return;
            }
            
            // 设置设备名称
            const text = '您的名称是 ' + displayName;
            displayNameEl.textContent = text;
            
            // 存储到全局变量
            window.currentDisplayName = displayName;
            
            console.log('✅ 设备名称已更新:', text);
            console.log('📱 设备类型:', deviceName);
            
            // 添加样式确保可见
            displayNameEl.style.display = 'block';
            displayNameEl.style.visibility = 'visible';
            displayNameEl.style.opacity = '1';
            displayNameEl.style.color = '#666';
            displayNameEl.style.fontSize = '14px';
            
            if (deviceName) {
                displayNameEl.title = deviceName;
            }
        }
        
        // 监听服务器发送的display-name事件
        function setupDisplayNameListener() {
            if (window.Events) {
                window.Events.on('display-name', function(e) {
                    console.log('📡 收到服务器设备名称:', e.detail);
                    const message = e.detail.message || e.detail;
                    if (message && message.displayName) {
                        serverDisplayName = message.displayName;
                        hasReceivedServerName = true;
                        updateDisplayName(message.displayName, message.deviceName);
                        
                        // 存储当前用户的peer ID
                        if (message.peerId) {
                            window.currentPeerId = message.peerId;
                            console.log('📱 当前用户Peer ID:', message.peerId);
                        }
                    }
                });
                console.log('✅ display-name事件监听器已设置');
            } else {
                console.log('⚠️ Events对象未找到，稍后重试...');
                setTimeout(setupDisplayNameListener, 500);
            }
        }
        
        // 备用方案：如果5秒内没有收到服务器名称，生成临时名称
        function fallbackDisplayName() {
            if (!hasReceivedServerName) {
                console.log('⚠️ 未收到服务器设备名称，使用备用方案');
                const adjectives = ['Blue', 'Red', 'Green', 'Orange', 'Purple', 'Yellow', 'Pink', 'Cyan', 'Rose'];
                const animals = ['Bear', 'Wolf', 'Eagle', 'Lion', 'Tiger', 'Fox', 'Hawk', 'Shark', 'Falcon', 'Dolphin'];
                
                const randomAdjective = adjectives[Math.floor(Math.random() * adjectives.length)];
                const randomAnimal = animals[Math.floor(Math.random() * animals.length)];
                const deviceName = randomAdjective + ' ' + randomAnimal;
                
                updateDisplayName(deviceName, 'Computer');
            }
        }
        
        // 初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupDisplayNameListener);
        } else {
            setupDisplayNameListener();
        }
        
        // 5秒后检查是否需要备用方案
        setTimeout(fallbackDisplayName, 5000);
    })();
    </script>
    
    <!-- UI管理器初始化 -->
    <script>
        // 初始化UI管理器来处理设备发现和显示
        document.addEventListener('DOMContentLoaded', function() {
            // 等待网络模块初始化
            setTimeout(() => {
                if (window.UI && !window.ui) {
                    window.ui = new UI();
                    console.log('✅ UI管理器已初始化');
                } else if (window.ui) {
                    console.log('✅ UI管理器已存在');
                } else {
                    console.log('⚠️ UI类未找到，尝试手动处理peers事件');
                    
                    // 手动处理peers事件
                    if (window.network && window.network.Events) {
                        window.network.Events.on('peers', function(e) {
                            console.log('📱 收到peers列表:', e.detail);
                            
                            // 清空现有设备列表
                            const peersContainer = document.querySelector('x-peers');
                            if (peersContainer) {
                                peersContainer.innerHTML = '';
                            }
                            
                            // 显示每个设备
                            if (e.detail && Array.isArray(e.detail)) {
                                e.detail.forEach(peer => {
                                    console.log('📱 添加设备:', peer);
                                    addPeerToUI(peer);
                                });
                            }
                        });
                        
                        window.network.Events.on('peer-joined', function(e) {
                            console.log('📱 新设备加入:', e.detail);
                            if (e.detail && e.detail.peer) {
                                addPeerToUI(e.detail.peer);
                            }
                        });
                        
                        window.network.Events.on('peer-left', function(e) {
                            console.log('📱 设备离开:', e.detail);
                            removePeerFromUI(e.detail);
                        });
                        
                        console.log('✅ 手动peers事件监听器已设置');
                    }
                }
            }, 2000);
        });
        
        // 添加设备到UI的函数
        function addPeerToUI(peer) {
            if (!peer || !peer.id) return;
            
            const peersContainer = document.querySelector('x-peers');
            if (!peersContainer) {
                console.log('❌ 找不到peers容器');
                return;
            }
            
            // 检查是否已存在
            if (document.getElementById(peer.id)) {
                console.log('📱 设备已存在，跳过:', peer.id);
                return;
            }
            
            // 创建设备元素
            const peerElement = document.createElement('x-peer');
            peerElement.id = peer.id;
            peerElement.innerHTML = `
                <div class="peer-info">
                    <div class="peer-name">${peer.name || peer.id.substring(0, 8)}</div>
                    <div class="peer-type">${peer.deviceType || 'Computer'}</div>
                </div>
                <div class="peer-actions">
                    <button class="send-btn" onclick="sendToPeer('${peer.id}')">发送文件</button>
                </div>
            `;
            
            peersContainer.appendChild(peerElement);
            console.log('✅ 设备已添加到UI:', peer.name || peer.id);
        }
        
        // 从UI移除设备的函数
        function removePeerFromUI(peerId) {
            const peerElement = document.getElementById(peerId);
            if (peerElement) {
                peerElement.remove();
                console.log('✅ 设备已从UI移除:', peerId);
            }
        }
        
        // 发送文件到指定设备的函数
        function sendToPeer(peerId) {
            console.log('📤 发送文件到设备:', peerId);
            // 这里可以添加文件选择逻辑
            alert('选择文件功能待实现');
        }
        
        // 移动端汉堡菜单展开/收起
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const mobileNav = document.getElementById('mobileNavLinks');
        const menuBackdrop = document.getElementById('menuBackdrop');
        
        if (hamburgerBtn && mobileNav) {
            const closeMenu = () => {
                mobileNav.classList.remove('mobile-open');
                if (menuBackdrop) menuBackdrop.classList.remove('show');
            };
            
            hamburgerBtn.addEventListener('click', () => {
                const willOpen = !mobileNav.classList.contains('mobile-open');
                mobileNav.classList.toggle('mobile-open');
                if (menuBackdrop) menuBackdrop.classList.toggle('show', willOpen);
            });
            
            if (menuBackdrop) menuBackdrop.addEventListener('click', closeMenu);
            
            // 路由或哈希变化时关闭
            window.addEventListener('hashchange', closeMenu);
            window.addEventListener('popstate', closeMenu);
            
            // 点击任一链接后关闭
            const navLinks = mobileNav.querySelectorAll('a');
            navLinks.forEach(a => a.addEventListener('click', closeMenu));
            
            // 尺寸变化到桌面端时强制关闭
            const mql = window.matchMedia('(min-width: 769px)');
            mql.addEventListener('change', e => { if (e.matches) closeMenu(); });
        }
        
        // 语言选择器 - 集成i18n系统
        const languageSelector = document.getElementById('languageSelector');
        if (languageSelector) {
            languageSelector.addEventListener('change', function() {
                if (window.DROPSHARE_I18N && typeof window.DROPSHARE_I18N.setLanguage === 'function') {
                    window.DROPSHARE_I18N.setLanguage(this.value);
                } else {
                    console.log('语言切换到:', this.value);
                }
             });
         }
         
         // 初始化i18n翻译系统
         if (window.DROPSHARE_I18N && typeof window.DROPSHARE_I18N.initialize === 'function') {
             window.DROPSHARE_I18N.initialize();
         }
     </script>
 </body>
 
 </html>































































