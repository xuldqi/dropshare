<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="analytics_test_title">Firebase Analytics æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #3367d6;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .test-button {
            background: #3367d6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .test-button.success {
            background: #10b981;
        }
        .test-button.error {
            background: #ef4444;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3367d6;
        }
        .log-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .file-input {
            margin: 10px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: #3367d6;
            transition: width 0.3s ease;
            width: 0%;
        }
    </style>
    <link rel="stylesheet" href="share-integration.css">
    <link rel="stylesheet" href="device-selector.css">
    <script src="/locales/i18n.js"></script>
</head>
<body>
    <h1>ğŸ”¥ Firebase Analytics æµ‹è¯•é¢æ¿</h1>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•DropShareçš„Firebase Analyticsé›†æˆæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>

    <div class="test-section">
        <h2 class="test-title">ğŸ“Š åŸºç¡€ç»Ÿè®¡æµ‹è¯•</h2>
        <div id="basic-status" class="status info">åˆå§‹åŒ–ä¸­...</div>
        
        <button class="test-button" onclick="testPageView()">æµ‹è¯•é¡µé¢è®¿é—®</button>
        <button class="test-button" onclick="testCustomEvent()">æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶</button>
        <button class="test-button" onclick="testUserInteraction()">æµ‹è¯•ç”¨æˆ·äº¤äº’</button>
        <button class="test-button" onclick="testPerformanceMetrics()">æµ‹è¯•æ€§èƒ½æŒ‡æ ‡</button>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ› ï¸ å·¥å…·åŠŸèƒ½æµ‹è¯•</h2>
        <div id="tools-status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
        
        <input type="file" class="file-input" id="test-file" multiple accept="image/*">
        <button class="test-button" onclick="testFileSelection()">æµ‹è¯•æ–‡ä»¶é€‰æ‹©</button>
        <button class="test-button" onclick="testProcessingStart()">æµ‹è¯•å¤„ç†å¼€å§‹</button>
        <button class="test-button" onclick="testProcessingProgress()">æµ‹è¯•å¤„ç†è¿›åº¦</button>
        <button class="test-button" onclick="testProcessingComplete()">æµ‹è¯•å¤„ç†å®Œæˆ</button>
        <button class="test-button error" onclick="testProcessingError()">æµ‹è¯•å¤„ç†é”™è¯¯</button>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ“± è®¾å¤‡å’Œç½‘ç»œä¿¡æ¯</h2>
        <div id="device-info" class="status info">åŠ è½½ä¸­...</div>
        <button class="test-button" onclick="testNetworkInfo()">æµ‹è¯•ç½‘ç»œä¿¡æ¯</button>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ“ˆ ç»Ÿè®¡æ•°æ®æ¦‚è§ˆ</h2>
        <button class="test-button" onclick="showStats()">æ˜¾ç¤ºç»Ÿè®¡æ‘˜è¦</button>
        <div id="stats-display" class="log-output" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ“ å®æ—¶æ—¥å¿—</h2>
        <button class="test-button" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="log-display" class="log-output"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics-compat.js"></script>
    
    <!-- Firebase Analytics Configuration -->
    <script src="scripts/firebase-analytics.js"></script>
    <script src="scripts/analytics-enhanced.js"></script>
    <script src="scripts/tools-analytics.js"></script>

    <script>
        let testCounter = 0;
        let progressInterval;

        // æ—¥å¿—åŠŸèƒ½
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDisplay = document.getElementById('log-display');
            const prefix = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'ğŸ“';
            logDisplay.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logDisplay.scrollTop = logDisplay.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('log-display').textContent = '';
        }

        // åŸºç¡€æµ‹è¯•åŠŸèƒ½
        function testPageView() {
            try {
                if (window.analyticsEnhanced) {
                    window.analyticsEnhanced.trackEvent('test_page_view', {
                        test_id: ++testCounter,
                        test_timestamp: Date.now()
                    });
                    log('é¡µé¢è®¿é—®äº‹ä»¶å·²å‘é€', 'success');
                    updateBasicStatus('é¡µé¢è®¿é—®æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    throw new Error('analyticsEnhanced æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`é¡µé¢è®¿é—®æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateBasicStatus('é¡µé¢è®¿é—®æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testCustomEvent() {
            try {
                if (window.analyticsEnhanced) {
                    window.analyticsEnhanced.trackEvent('test_custom_event', {
                        event_type: 'analytics_test',
                        test_id: ++testCounter,
                        custom_data: 'Hello Firebase!'
                    });
                    log('è‡ªå®šä¹‰äº‹ä»¶å·²å‘é€', 'success');
                    updateBasicStatus('è‡ªå®šä¹‰äº‹ä»¶æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    throw new Error('analyticsEnhanced æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`è‡ªå®šä¹‰äº‹ä»¶æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateBasicStatus('è‡ªå®šä¹‰äº‹ä»¶æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testUserInteraction() {
            try {
                if (window.analyticsEnhanced) {
                    window.analyticsEnhanced.trackUserInteraction('button_click', 'test_button', {
                        button_name: 'test_user_interaction',
                        test_id: ++testCounter
                    });
                    log('ç”¨æˆ·äº¤äº’äº‹ä»¶å·²å‘é€', 'success');
                    updateBasicStatus('ç”¨æˆ·äº¤äº’æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    throw new Error('analyticsEnhanced æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`ç”¨æˆ·äº¤äº’æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateBasicStatus('ç”¨æˆ·äº¤äº’æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testPerformanceMetrics() {
            try {
                if (window.analyticsEnhanced) {
                    window.analyticsEnhanced.trackPerformance();
                    log('æ€§èƒ½æŒ‡æ ‡å·²å‘é€', 'success');
                    updateBasicStatus('æ€§èƒ½æŒ‡æ ‡æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    throw new Error('analyticsEnhanced æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`æ€§èƒ½æŒ‡æ ‡æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateBasicStatus('æ€§èƒ½æŒ‡æ ‡æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        // å·¥å…·æµ‹è¯•åŠŸèƒ½
        function testFileSelection() {
            try {
                const fileInput = document.getElementById('test-file');
                const files = fileInput.files;
                
                if (files.length === 0) {
                    // æ¨¡æ‹Ÿæ–‡ä»¶é€‰æ‹©
                    const mockFile = new File(['test content'], 'test.jpg', {
                        type: 'image/jpeg',
                        lastModified: Date.now()
                    });
                    
                    if (window.toolsAnalytics) {
                        window.toolsAnalytics.trackFileSelection(mockFile);
                        log('æ¨¡æ‹Ÿæ–‡ä»¶é€‰æ‹©äº‹ä»¶å·²å‘é€', 'success');
                        updateToolsStatus('æ–‡ä»¶é€‰æ‹©æµ‹è¯•æˆåŠŸ', 'success');
                    } else {
                        throw new Error('toolsAnalytics æœªåˆå§‹åŒ–');
                    }
                } else {
                    Array.from(files).forEach(file => {
                        if (window.toolsAnalytics) {
                            window.toolsAnalytics.trackFileSelection(file);
                        }
                    });
                    log(`${files.length}ä¸ªæ–‡ä»¶é€‰æ‹©äº‹ä»¶å·²å‘é€`, 'success');
                    updateToolsStatus('æ–‡ä»¶é€‰æ‹©æµ‹è¯•æˆåŠŸ', 'success');
                }
            } catch (error) {
                log(`æ–‡ä»¶é€‰æ‹©æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateToolsStatus('æ–‡ä»¶é€‰æ‹©æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testProcessingStart() {
            try {
                const mockFiles = [
                    new File(['test content 1'], 'test1.jpg', { type: 'image/jpeg' }),
                    new File(['test content 2'], 'test2.png', { type: 'image/png' })
                ];
                
                if (window.toolsAnalytics) {
                    window.toolsAnalytics.trackProcessingStart(mockFiles);
                    log('å¤„ç†å¼€å§‹äº‹ä»¶å·²å‘é€', 'success');
                    updateToolsStatus('å¤„ç†å¼€å§‹æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    throw new Error('toolsAnalytics æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`å¤„ç†å¼€å§‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateToolsStatus('å¤„ç†å¼€å§‹æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testProcessingProgress() {
            try {
                if (window.toolsAnalytics) {
                    let progress = 0;
                    const progressFill = document.getElementById('progress-fill');
                    
                    progressInterval = setInterval(() => {
                        progress += 10;
                        progressFill.style.width = progress + '%';
                        
                        window.toolsAnalytics.trackProcessingProgress(progress);
                        log(`å¤„ç†è¿›åº¦: ${progress}%`, 'info');
                        
                        if (progress >= 100) {
                            clearInterval(progressInterval);
                            updateToolsStatus('å¤„ç†è¿›åº¦æµ‹è¯•å®Œæˆ', 'success');
                        }
                    }, 200);
                    
                    log('å¤„ç†è¿›åº¦æµ‹è¯•å¼€å§‹', 'success');
                } else {
                    throw new Error('toolsAnalytics æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`å¤„ç†è¿›åº¦æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateToolsStatus('å¤„ç†è¿›åº¦æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testProcessingComplete() {
            try {
                const mockOutputFiles = [
                    { name: 'compressed_test1.jpg', type: 'image/jpeg', size: 50000 },
                    { name: 'compressed_test2.jpg', type: 'image/jpeg', size: 45000 }
                ];
                
                const mockInputFiles = [
                    { name: 'test1.jpg', type: 'image/jpeg', size: 100000 },
                    { name: 'test2.png', type: 'image/png', size: 120000 }
                ];
                
                if (window.toolsAnalytics) {
                    window.toolsAnalytics.trackProcessingComplete(mockOutputFiles, mockInputFiles);
                    log('å¤„ç†å®Œæˆäº‹ä»¶å·²å‘é€', 'success');
                    updateToolsStatus('å¤„ç†å®Œæˆæµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    throw new Error('toolsAnalytics æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`å¤„ç†å®Œæˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateToolsStatus('å¤„ç†å®Œæˆæµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testProcessingError() {
            try {
                const mockError = new Error('æ¨¡æ‹Ÿå¤„ç†é”™è¯¯');
                mockError.name = 'ProcessingError';
                
                if (window.toolsAnalytics) {
                    window.toolsAnalytics.trackProcessingError(mockError, 'analytics_test');
                    log('å¤„ç†é”™è¯¯äº‹ä»¶å·²å‘é€', 'success');
                    updateToolsStatus('å¤„ç†é”™è¯¯æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    throw new Error('toolsAnalytics æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`å¤„ç†é”™è¯¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateToolsStatus('å¤„ç†é”™è¯¯æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testNetworkInfo() {
            try {
                if (window.analyticsEnhanced) {
                    window.analyticsEnhanced.trackNetworkInfo();
                    log('ç½‘ç»œä¿¡æ¯äº‹ä»¶å·²å‘é€', 'success');
                } else {
                    throw new Error('analyticsEnhanced æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                log(`ç½‘ç»œä¿¡æ¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function showStats() {
            try {
                const statsDisplay = document.getElementById('stats-display');
                let stats = {};
                
                if (window.analyticsEnhanced) {
                    stats.enhanced = window.analyticsEnhanced.getStats();
                }
                
                if (window.toolsAnalytics) {
                    stats.tools = window.toolsAnalytics.getStatsSummary();
                }
                
                statsDisplay.textContent = JSON.stringify(stats, null, 2);
                statsDisplay.style.display = 'block';
                log('ç»Ÿè®¡æ•°æ®å·²æ˜¾ç¤º', 'success');
            } catch (error) {
                log(`æ˜¾ç¤ºç»Ÿè®¡æ•°æ®å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // çŠ¶æ€æ›´æ–°å‡½æ•°
        function updateBasicStatus(message, type) {
            const status = document.getElementById('basic-status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function updateToolsStatus(message, type) {
            const status = document.getElementById('tools-status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('Analyticsæµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // ç­‰å¾…Firebaseåˆå§‹åŒ–
            setTimeout(() => {
                const deviceInfo = document.getElementById('device-info');
                const info = {
                    userAgent: navigator.userAgent.substring(0, 80) + '...',
                    platform: navigator.platform,
                    language: navigator.language,
                    screen: `${screen.width}x${screen.height}`,
                    connection: navigator.connection ? navigator.connection.effectiveType : 'unknown'
                };
                
                deviceInfo.innerHTML = Object.entries(info)
                    .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                    .join('<br>');
                deviceInfo.className = 'status success';
                
                // æ£€æŸ¥Analyticsåˆå§‹åŒ–çŠ¶æ€
                if (window.analyticsEnhanced) {
                    updateBasicStatus('Enhanced Analytics å·²åˆå§‹åŒ–', 'success');
                    log('Enhanced Analytics åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    updateBasicStatus('Enhanced Analytics æœªåˆå§‹åŒ–', 'error');
                    log('Enhanced Analytics åˆå§‹åŒ–å¤±è´¥', 'error');
                }
                
                if (window.toolsAnalytics) {
                    updateToolsStatus('Tools Analytics å·²åˆå§‹åŒ–', 'success');
                    log('Tools Analytics åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    updateToolsStatus('Tools Analytics æœªåˆå§‹åŒ–', 'error');
                    log('Tools Analytics åˆå§‹åŒ–å¤±è´¥', 'error');
                }
                
                if (window.firebaseAnalytics) {
                    log('Firebase Analytics å·²è¿æ¥', 'success');
                } else {
                    log('Firebase Analytics è¿æ¥å¤±è´¥', 'error');
                }
            }, 2000);
        });
    </script>
    <!-- Share Integration -->
    <script src="device-selector.js"></script>
    <script src="add-share-integration.js"></script>
</body>
</html>