<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOCX to HTML Converter</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" type="text/css" href="styles/file-converter.css">
    <link rel="stylesheet" type="text/css" href="styles/ui-ux-enhancements.css">
    <style>
        body {
            padding: 20px;
            background: var(--bg-color);
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            color: var(--primary-color);
            text-decoration: none;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .page-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .converter-container {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 30px;
        }
        
        .tool-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .tool-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }
        
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background: var(--bg-color-secondary);
        }
        
        .upload-area.dragover {
            border-color: var(--primary-color);
            background: var(--bg-color-secondary);
        }
        
        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .file-info {
            display: none;
            background: var(--bg-color-secondary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .file-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .file-icon {
            font-size: 2em;
        }
        
        .conversion-options {
            display: none;
            margin-bottom: 30px;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .option-card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
        }
        
        .option-card label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .conversion-progress {
            display: none;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .progress-bar {
            background: var(--bg-color-secondary);
            border-radius: 20px;
            height: 8px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            background: var(--primary-color);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .conversion-result {
            display: none;
            background: var(--bg-color-secondary);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
        }
        
        .result-preview {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            text-align: left;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-color-dark);
        }
        
        .btn-secondary {
            background: var(--surface-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--bg-color-secondary);
        }
        
        .features-info {
            background: var(--bg-color-secondary);
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-item {
            text-align: center;
        }
        
        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        /* Device Modal Styles */
        .device-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .device-modal-content {
            background: var(--surface-color);
            border-radius: 12px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
        }
        
        .device-modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .device-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-muted);
        }
        
        .device-list {
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .device-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .device-item:hover {
            background: var(--bg-color-secondary);
        }
        
        .device-item.selected {
            background: var(--primary-color-light);
            border: 1px solid var(--primary-color);
        }
        
        .device-modal-actions {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn-cancel {
            background: var(--surface-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        
        .modal-btn-send {
            background: var(--primary-color);
            color: white;
        }
        
        .modal-btn-send:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }
    </style>
    <link rel="stylesheet" href="share-integration.css">
    <link rel="stylesheet" href="device-selector.css">
    <script src="/locales/i18n.js"></script>
</head>
<body>
    <div class="page-content">
        <div class="page-header">
            <h1><span data-i18n="docx_to_html_page_title">=ï¿½ DOCX to HTML Converter</span></h1>
            <a href="document-tools.html" class="back-button">
                <span data-i18n="back_to_document_tools">ï¿½ Back to Document Tools</span>
            </a>
        </div>
        
        <div class="converter-container">
            <div class="tool-header">
                <div class="tool-icon"><</div>
                <h2 data-i18n="docx_to_html_convert_title">Convert DOCX to HTML</h2>
                <p data-i18n="docx_to_html_description">Convert Microsoft Word documents to web-ready HTML format</p>
            </div>
            
            <!-- Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">=ï¿½</div>
                <h3 data-i18n="select_or_drag_files">Select or drag DOCX files here</h3>
                <p style="color: var(--text-muted); margin-top: 10px;">
                    <span data-i18n="supported_formats">Supports .docx, .doc files</span>
                </p>
                <input type="file" id="fileInput" style="display: none;" multiple accept=".docx,.doc">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()" style="margin-top: 15px;">
                    <span data-i18n="select_files">Select Files</span>
                </button>
            </div>
            
            <!-- File Info -->
            <div class="file-info" id="fileInfo">
                <h3 data-i18n="selected_files">Selected Files:</h3>
                <div id="fileDetails"></div>
            </div>
            
            <!-- Conversion Options -->
            <div class="conversion-options" id="conversionOptions">
                <h3 data-i18n="conversion_options">Conversion Options:</h3>
                <div class="options-grid">
                    <div class="option-card">
                        <label>
                            <input type="checkbox" id="preserveFormatting" checked>
                            <span data-i18n="preserve_formatting">Preserve formatting</span>
                        </label>
                    </div>
                    <div class="option-card">
                        <label>
                            <input type="checkbox" id="includeStyles" checked>
                            <span data-i18n="include_styles">Include CSS styles</span>
                        </label>
                    </div>
                    <div class="option-card">
                        <label>
                            <input type="checkbox" id="convertImages" checked>
                            <span data-i18n="convert_images">Convert images</span>
                        </label>
                    </div>
                    <div class="option-card">
                        <label>
                            <input type="checkbox" id="responsiveDesign">
                            <span data-i18n="responsive_design">Make responsive</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Conversion Progress -->
            <div class="conversion-progress" id="conversionProgress">
                <h4 data-i18n="conversion_progress">Conversion Progress:</h4>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div id="progressText">0%</div>
            </div>
            
            <!-- Action Buttons -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" id="convertBtn" disabled>
                    <span data-i18n="start_conversion">Start Conversion</span>
                </button>
                <button class="btn btn-secondary" id="clearBtn" style="margin-left: 10px;">
                    <span data-i18n="clear_files">Clear Files</span>
                </button>
            </div>
        </div>
        
        <!-- Conversion Results -->
        <div class="conversion-result" id="conversionResult">
            <h3><ï¿½ <span data-i18n="conversion_complete">Conversion Complete!</span></h3>
            <div class="result-preview" id="resultPreview">
                <!-- HTML preview will be shown here -->
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" id="downloadBtn">
                    =ï¿½ <span data-i18n="download_html">Download HTML</span>
                </button>
                <button class="btn btn-secondary" id="shareBtn">
                    =ï¿½ <span data-i18n="share_file">Share File</span>
                </button>
                <button class="btn btn-secondary" id="newConversionBtn">
                    = <span data-i18n="new_conversion">New Conversion</span>
                </button>
            </div>
        </div>
        
        <!-- Features Info -->
        <div class="features-info">
            <h3><span data-i18n="features">=ï¿½ Features</span></h3>
            <div class="features-grid">
                <div class="feature-item">
                    <div class="feature-icon"><ï¿½</div>
                    <h4 data-i18n="preserve_formatting_feature">Preserve Formatting</h4>
                    <p data-i18n="preserve_formatting_desc">Maintains original document styles and layout</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">=ï¿½</div>
                    <h4 data-i18n="image_support_feature">Image Support</h4>
                    <p data-i18n="image_support_desc">Converts embedded images to web formats</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">=ï¿½</div>
                    <h4 data-i18n="responsive_design_feature">Responsive Design</h4>
                    <p data-i18n="responsive_design_desc">Mobile-friendly HTML output</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">=</div>
                    <h4 data-i18n="secure_processing_feature">Secure Processing</h4>
                    <p data-i18n="secure_processing_desc">All processing happens locally</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Device Selection Modal -->
    <div class="device-modal" id="deviceModal">
        <div class="device-modal-content">
            <div class="device-modal-header">
                <h3 class="device-modal-title" data-i18n="select_devices">Select Transfer Devices</h3>
                <button class="device-modal-close" onclick="closeDeviceModal()">&times;</button>
            </div>
            <div class="device-list" id="deviceList">
                <!-- Device list will be populated here -->
            </div>
            <div class="device-modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeDeviceModal()" data-i18n="cancel">Cancel</button>
                <button class="modal-btn modal-btn-send" id="sendToDevicesBtn" onclick="sendToSelectedDevices()" disabled>
                    <span data-i18n="send_to_devices">Send to Selected Devices</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileDetails = document.getElementById('fileDetails');
        const conversionOptions = document.getElementById('conversionOptions');
        const convertBtn = document.getElementById('convertBtn');
        const clearBtn = document.getElementById('clearBtn');
        const conversionProgress = document.getElementById('conversionProgress');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const conversionResult = document.getElementById('conversionResult');
        const resultPreview = document.getElementById('resultPreview');
        const downloadBtn = document.getElementById('downloadBtn');
        const shareBtn = document.getElementById('shareBtn');
        const newConversionBtn = document.getElementById('newConversionBtn');
        
        let selectedFiles = [];
        let convertedFiles = [];

        // File drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(file => 
                file.name.toLowerCase().endsWith('.docx') || file.name.toLowerCase().endsWith('.doc')
            );
            if (files.length > 0) {
                handleFiles(files);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFiles(Array.from(e.target.files));
            }
        });

        function handleFiles(files) {
            selectedFiles = files;
            displayFileInfo();
            fileInfo.style.display = 'block';
            conversionOptions.style.display = 'block';
            convertBtn.disabled = false;
        }

        function displayFileInfo() {
            fileDetails.innerHTML = '';
            selectedFiles.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-details';
                fileDiv.innerHTML = `
                    <div class="file-icon">=ï¿½</div>
                    <div>
                        <div style="font-weight: 500;">${file.name}</div>
                        <div style="color: var(--text-muted); font-size: 0.9em;">
                            ${formatFileSize(file.size)} " ${file.type || 'DOCX Document'}
                        </div>
                    </div>
                `;
                fileDetails.appendChild(fileDiv);
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Conversion functionality
        convertBtn.addEventListener('click', startConversion);
        clearBtn.addEventListener('click', clearFiles);
        newConversionBtn.addEventListener('click', clearFiles);

        async function startConversion() {
            conversionProgress.style.display = 'block';
            convertBtn.disabled = true;
            
            convertedFiles = [];
            
            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                
                // Update progress
                const progress = Math.round(((i + 1) / selectedFiles.length) * 100);
                progressFill.style.width = progress + '%';
                progressText.textContent = `${progress}% - Converting ${file.name}`;
                
                // Simulate conversion process
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Simulate conversion result
                const htmlContent = await convertDocxToHtml(file);
                convertedFiles.push({
                    originalFile: file,
                    htmlContent: htmlContent,
                    filename: file.name.replace(/\.(docx?|doc)$/i, '.html')
                });
            }
            
            progressText.textContent = 'Conversion Complete!';
            
            setTimeout(() => {
                conversionProgress.style.display = 'none';
                showConversionResult();
            }, 500);
        }

        async function convertDocxToHtml(file) {
            // This is simulated conversion logic
            // In a real project, you would use an actual DOCX conversion library
            const preserveFormatting = document.getElementById('preserveFormatting').checked;
            const includeStyles = document.getElementById('includeStyles').checked;
            const convertImages = document.getElementById('convertImages').checked;
            const responsiveDesign = document.getElementById('responsiveDesign').checked;
            
            let htmlContent = '';
            
            // Start HTML document
            htmlContent += '<!DOCTYPE html>\n<html lang="en">\n<head>\n';
            htmlContent += '    <meta charset="UTF-8">\n';
            htmlContent += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
            htmlContent += `    <title>${file.name.replace(/\.(docx?|doc)$/i, '')}</title>\n`;
            
            if (includeStyles) {
                htmlContent += '    <style>\n';
                htmlContent += '        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }\n';
                htmlContent += '        h1, h2, h3 { color: #333; }\n';
                htmlContent += '        p { margin-bottom: 1em; }\n';
                
                if (responsiveDesign) {
                    htmlContent += '        @media (max-width: 768px) { body { margin: 20px; } }\n';
                    htmlContent += '        img { max-width: 100%; height: auto; }\n';
                }
                
                htmlContent += '    </style>\n';
            }
            
            htmlContent += '</head>\n<body>\n';
            
            // Document content
            htmlContent += `    <h1>${file.name.replace(/\.(docx?|doc)$/i, '')}</h1>\n\n`;
            htmlContent += '    <p>This is the converted HTML content from ' + file.name + '.</p>\n\n';
            
            if (preserveFormatting) {
                htmlContent += '    <h2>Document Structure</h2>\n';
                htmlContent += '    <p>This document maintains the original formatting including:</p>\n';
                htmlContent += '    <ul>\n';
                htmlContent += '        <li><strong>Bold text</strong> and <em>italic text</em></li>\n';
                htmlContent += '        <li>Paragraph spacing and alignment</li>\n';
                htmlContent += '        <li>Headings and subheadings</li>\n';
                htmlContent += '        <li>Lists and formatting</li>\n';
                htmlContent += '    </ul>\n\n';
            }
            
            htmlContent += '    <h2>Sample Content</h2>\n';
            htmlContent += '    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>\n\n';
            htmlContent += '    <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>\n\n';
            
            if (convertImages) {
                htmlContent += '    <h3>Images</h3>\n';
                htmlContent += '    <p>Images from the original document have been converted and embedded:</p>\n';
                htmlContent += '    <div style="text-align: center; margin: 20px 0;">\n';
                htmlContent += '        <div style="background: #f0f0f0; padding: 40px; border: 1px dashed #ccc; color: #666;">\n';
                htmlContent += '            [Image placeholder - Original images would appear here]\n';
                htmlContent += '        </div>\n';
                htmlContent += '    </div>\n\n';
            }
            
            htmlContent += '    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee; font-size: 0.9em; color: #666;">\n';
            htmlContent += `        <p>Converted from ${file.name} using DropShare DOCX to HTML Converter</p>\n`;
            htmlContent += `        <p>Conversion date: ${new Date().toLocaleString()}</p>\n`;
            htmlContent += '    </footer>\n';
            
            htmlContent += '</body>\n</html>';
            
            return htmlContent;
        }

        function showConversionResult() {
            conversionResult.style.display = 'block';
            
            if (convertedFiles.length > 0) {
                resultPreview.innerHTML = convertedFiles[0].htmlContent;
            }
            
            // Scroll to result area
            conversionResult.scrollIntoView({ behavior: 'smooth' });
        }

        function clearFiles() {
            selectedFiles = [];
            convertedFiles = [];
            fileInput.value = '';
            fileInfo.style.display = 'none';
            conversionOptions.style.display = 'none';
            conversionProgress.style.display = 'none';
            conversionResult.style.display = 'none';
            convertBtn.disabled = true;
            progressFill.style.width = '0%';
            progressText.textContent = '0%';
        }

        // Download functionality
        downloadBtn.addEventListener('click', () => {
            if (convertedFiles.length === 0) return;
            
            if (convertedFiles.length === 1) {
                downloadSingleFile(convertedFiles[0]);
            } else {
                downloadAllFiles();
            }
        });

        function downloadSingleFile(fileData) {
            const blob = new Blob([fileData.htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileData.filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadAllFiles() {
            // If multiple files, create ZIP download
            const JSZip = window.JSZip;
            if (!JSZip) {
                // If JSZip library is not available, download files individually
                convertedFiles.forEach((fileData, index) => {
                    setTimeout(() => downloadSingleFile(fileData), index * 100);
                });
                return;
            }
            
            const zip = new JSZip();
            convertedFiles.forEach(fileData => {
                zip.file(fileData.filename, fileData.htmlContent);
            });
            
            zip.generateAsync({ type: 'blob' }).then(content => {
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'converted_html_files.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }

        // Share functionality
        shareBtn.addEventListener('click', () => {
            if (convertedFiles.length === 0) return;
            openDeviceModal();
        });

        // Device selection modal functionality
        let selectedDevices = new Set();

        function openDeviceModal() {
            const modal = document.getElementById('deviceModal');
            modal.style.display = 'flex';
            populateDeviceList();
        }

        function closeDeviceModal() {
            const modal = document.getElementById('deviceModal');
            modal.style.display = 'none';
            selectedDevices.clear();
            updateSendButton();
        }

        function populateDeviceList() {
            const deviceList = document.getElementById('deviceList');
            deviceList.innerHTML = '';
            
            // Mock device list
            const mockDevices = [
                { id: 'device1', name: 'iPhone 12', type: 'mobile', icon: '=ï¿½' },
                { id: 'device2', name: 'MacBook Pro', type: 'desktop', icon: '=ï¿½' },
                { id: 'device3', name: 'iPad Air', type: 'tablet', icon: '=ï¿½' },
                { id: 'device4', name: 'Chrome Desktop', type: 'desktop', icon: '=ï¿½' }
            ];
            
            mockDevices.forEach(device => {
                const deviceItem = document.createElement('div');
                deviceItem.className = 'device-item';
                deviceItem.innerHTML = `
                    <div style="font-size: 1.5em;">${device.icon}</div>
                    <div>
                        <div style="font-weight: 500;">${device.name}</div>
                        <div style="color: var(--text-muted); font-size: 0.9em;">${device.type}</div>
                    </div>
                `;
                
                deviceItem.addEventListener('click', () => {
                    if (selectedDevices.has(device.id)) {
                        selectedDevices.delete(device.id);
                        deviceItem.classList.remove('selected');
                    } else {
                        selectedDevices.add(device.id);
                        deviceItem.classList.add('selected');
                    }
                    updateSendButton();
                });
                
                deviceList.appendChild(deviceItem);
            });
        }

        function updateSendButton() {
            const sendBtn = document.getElementById('sendToDevicesBtn');
            const span = sendBtn.querySelector('span');
            const count = selectedDevices.size;
            
            if (count === 0) {
                sendBtn.disabled = true;
                if (span) span.textContent = 'Send to Selected Devices';
            } else {
                sendBtn.disabled = false;
                if (span) span.textContent = `Send to ${count} Device${count > 1 ? 's' : ''}`;
            }
        }

        function sendToSelectedDevices() {
            if (selectedDevices.size === 0) return;
            
            const deviceCount = selectedDevices.size;
            
            // This should integrate with the actual file transfer functionality
            if (window.ui && window.ui.filesQueue) {
                // If transfer system is available, add files to queue
                convertedFiles.forEach(fileData => {
                    const blob = new Blob([fileData.htmlContent], { type: 'text/html' });
                    const file = new File([blob], fileData.filename, { type: 'text/html' });
                    window.ui.filesQueue.push(file);
                });
                
                alert(`Files started transferring to ${deviceCount} device${deviceCount > 1 ? 's' : ''}!`);
                closeDeviceModal();
            } else {
                // If transfer system is not available, provide redirect option
                if (confirm('Transfer functionality requires returning to the transfer page.\n\nWould you like to go to the transfer page now?')) {
                    // Store file information in sessionStorage for the transfer page
                    const fileInfo = convertedFiles.map(fileData => ({
                        name: fileData.filename,
                        type: 'text/html',
                        size: new Blob([fileData.htmlContent]).size,
                        content: fileData.htmlContent
                    }));
                    
                    sessionStorage.setItem('pendingFileTransfer', JSON.stringify({
                        files: fileInfo,
                        timestamp: Date.now()
                    }));
                    
                    window.location.href = 'index.html';
                }
            }
        }

        // Initialize page after loading
        document.addEventListener('DOMContentLoaded', () => {
            // Load internationalization
            if (typeof loadLanguage === 'function') {
                loadLanguage();
            }
        });
    </script>
    
    <!-- Share Integration -->
    <script src="device-selector.js"></script>
    <script src="add-share-integration.js"></script>
</body>
</html>