<!DOCTYPE html>
<html>
<head>
    <title>Share Functionality Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .status { padding: 10px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Share Page Functionality Test</h1>
    
    <div class="test-section">
        <h3>1. Network Connection Test</h3>
        <div id="network-status" class="status info">Testing network connection...</div>
        <button onclick="testNetwork()">Test Network</button>
    </div>
    
    <div class="test-section">
        <h3>2. File Input Test</h3>
        <input type="file" id="fileTest" multiple>
        <div id="file-status" class="status info">Select files to test</div>
    </div>
    
    <div class="test-section">
        <h3>3. WebRTC Support Test</h3>
        <div id="webrtc-status" class="status info">Testing WebRTC support...</div>
    </div>
    
    <div class="test-section">
        <h3>4. WebSocket Connection Test</h3>
        <div id="websocket-status" class="status info">Testing WebSocket connection...</div>
    </div>

    <script>
        // Test network connection
        function testNetwork() {
            const status = document.getElementById('network-status');
            fetch('/api/ping')
                .then(response => {
                    if (response.ok) {
                        status.className = 'status success';
                        status.textContent = 'Network connection: OK';
                    } else {
                        status.className = 'status error';
                        status.textContent = 'Network connection: Failed';
                    }
                })
                .catch(error => {
                    status.className = 'status error';
                    status.textContent = 'Network connection: Error - ' + error.message;
                });
        }
        
        // Test file input
        document.getElementById('fileTest').addEventListener('change', function(e) {
            const status = document.getElementById('file-status');
            if (e.target.files.length > 0) {
                status.className = 'status success';
                status.textContent = `File selection: OK (${e.target.files.length} files selected)`;
            } else {
                status.className = 'status info';
                status.textContent = 'No files selected';
            }
        });
        
        // Test WebRTC support
        function testWebRTC() {
            const status = document.getElementById('webrtc-status');
            if (window.RTCPeerConnection) {
                status.className = 'status success';
                status.textContent = 'WebRTC: Supported';
            } else {
                status.className = 'status error';
                status.textContent = 'WebRTC: Not supported';
            }
        }
        
        // Test WebSocket connection
        function testWebSocket() {
            const status = document.getElementById('websocket-status');
            try {
                const ws = new WebSocket('ws://localhost:8001');
                ws.onopen = function() {
                    status.className = 'status success';
                    status.textContent = 'WebSocket: Connection successful';
                    ws.close();
                };
                ws.onerror = function() {
                    status.className = 'status error';
                    status.textContent = 'WebSocket: Connection failed';
                };
            } catch (error) {
                status.className = 'status error';
                status.textContent = 'WebSocket: Error - ' + error.message;
            }
        }
        
        // Run tests on page load
        window.addEventListener('load', function() {
            testWebRTC();
            testWebSocket();
            testNetwork();
        });
    </script>
</body>
</html>