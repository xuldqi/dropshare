<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Languages i18n Test - DropShare</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .language-selector {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .translation-test {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .warning { color: orange; }
        .language-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .lang-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #fff;
        }
        .lang-card h3 {
            margin-top: 0;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        .coverage-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .coverage-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
        .missing-keys {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
        .key-list {
            max-height: 100px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸŒ All Languages i18n Test</h1>
    <p>This page tests the translation completeness for all supported languages in DropShare.</p>
    
    <div class="language-selector">
        <label for="lang-select"><strong>Test Language:</strong></label>
        <select id="lang-select">
            <option value="en">English</option>
            <option value="zh">ä¸­æ–‡ç®€ä½“</option>
            <option value="zh-tw">ä¸­æ–‡ç¹é«”</option>
            <option value="fr">FranÃ§ais</option>
            <option value="de">Deutsch</option>
            <option value="es">EspaÃ±ol</option>
            <option value="pt">PortuguÃªs</option>
            <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="ko">í•œêµ­ì–´</option>
        </select>
        <button onclick="testAllLanguages()" style="margin-left: 10px; padding: 5px 15px;">Test All Languages</button>
    </div>

    <div class="test-section">
        <h2>Current Language Test</h2>
        <div class="translation-test">
            <strong>Room Title:</strong> <span data-i18n="room_title">Multi-User Sharing Room</span>
        </div>
        <div class="translation-test">
            <strong>Create Room Button:</strong> <span data-i18n="create_room_btn">Create Room</span>
        </div>
        <div class="translation-test">
            <strong>Join Room Button:</strong> <span data-i18n="join_room_btn">Join Room</span>
        </div>
        <div class="translation-test">
            <strong>Room Name Label:</strong> <span data-i18n="room_name_label">Room Name</span>
        </div>
        <div class="translation-test">
            <strong>Upload Files to Room:</strong> <span data-i18n="upload_files_to_room">ğŸ“¤ Upload Files to Room</span>
        </div>
    </div>

    <div class="test-section">
        <h2>Language Coverage Analysis</h2>
        <div id="language-status" class="language-status">
            <!-- Language status cards will be populated here -->
        </div>
    </div>

    <div class="test-section">
        <h2>System Status</h2>
        <div id="status"></div>
    </div>

    <!-- Load the language loader first -->
    <script src="scripts/i18n/languages.js"></script>
    
    <script>
        // ç­‰å¾…è¯­è¨€ç³»ç»ŸåŠ è½½
        function waitForLanguages() {
            if (window.LANGUAGES && window.DROPSHARE_I18N) {
                initializeTest();
            } else {
                setTimeout(waitForLanguages, 100);
            }
        }

        function initializeTest() {
            console.log('è¯­è¨€ç³»ç»Ÿå·²åŠ è½½');
            
            // è®¾ç½®è¯­è¨€é€‰æ‹©å™¨
            const langSelect = document.getElementById('lang-select');
            langSelect.value = window.DROPSHARE_I18N.getCurrentLanguage();
            
            langSelect.addEventListener('change', function(e) {
                const newLang = e.target.value;
                console.log('åˆ‡æ¢è¯­è¨€åˆ°:', newLang);
                window.DROPSHARE_I18N.changeLanguage(newLang);
                applyTranslations();
                updateStatus();
            });

            // åº”ç”¨ç¿»è¯‘
            applyTranslations();
            updateStatus();
            
            // åˆ†ææ‰€æœ‰è¯­è¨€
            analyzeAllLanguages();
        }

        function applyTranslations() {
            const elements = document.querySelectorAll('[data-i18n]');
            console.log(`æ‰¾åˆ° ${elements.length} ä¸ªéœ€è¦ç¿»è¯‘çš„å…ƒç´ `);
            
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = window.DROPSHARE_I18N.getText(key);
                if (translation) {
                    element.textContent = translation;
                    console.log(`ç¿»è¯‘ "${key}" -> "${translation}"`);
                } else {
                    console.warn(`æœªæ‰¾åˆ°ç¿»è¯‘é”®: ${key}`);
                    element.style.color = 'red';
                }
            });
        }

        function analyzeAllLanguages() {
            const statusDiv = document.getElementById('language-status');
            const languages = window.LANGUAGES;
            
            let html = '';
            
            // å®šä¹‰å…³é”®ç¿»è¯‘é”®
            const criticalKeys = [
                'room_title', 'room_subtitle', 'create_room_btn', 'join_room_btn',
                'room_name_label', 'room_password_label', 'max_members_label',
                'confirm_create_room', 'cancel_create_room', 'join_room_title',
                'room_code_label', 'join_password_label', 'confirm_join_room',
                'copy_room_code', 'your_name_label', 'members_online',
                'room_members_label', 'leave_room_btn', 'upload_files_to_room',
                'drag_files_here', 'files_shared_to_all', 'select_files_upload',
                'room_shared_files', 'files_count', 'no_shared_files', 'upload_hint'
            ];
            
            Object.keys(languages).forEach(langCode => {
                const lang = languages[langCode];
                const translations = lang.translations;
                
                // è®¡ç®—è¦†ç›–ç‡
                const totalKeys = Object.keys(translations).length;
                const criticalKeysFound = criticalKeys.filter(key => translations[key]).length;
                const criticalCoverage = (criticalKeysFound / criticalKeys.length) * 100;
                const overallCoverage = (totalKeys / 200) * 100; // å‡è®¾æ€»å…±æœ‰200ä¸ªé”®
                
                // æ‰¾å‡ºç¼ºå¤±çš„å…³é”®é”®
                const missingCriticalKeys = criticalKeys.filter(key => !translations[key]);
                
                html += `
                    <div class="lang-card">
                        <h3>${lang.name} (${langCode})</h3>
                        <p><strong>æ€»ç¿»è¯‘é”®:</strong> ${totalKeys}</p>
                        <p><strong>å…³é”®é”®è¦†ç›–ç‡:</strong> ${criticalCoverage.toFixed(1)}%</p>
                        <div class="coverage-bar">
                            <div class="coverage-fill" style="width: ${criticalCoverage}%"></div>
                        </div>
                        <p><strong>æ•´ä½“è¦†ç›–ç‡:</strong> ${overallCoverage.toFixed(1)}%</p>
                        <div class="coverage-bar">
                            <div class="coverage-fill" style="width: ${overallCoverage}%"></div>
                        </div>
                        ${missingCriticalKeys.length > 0 ? `
                            <div class="missing-keys">
                                <strong>ç¼ºå¤±çš„å…³é”®é”® (${missingCriticalKeys.length}):</strong>
                                <div class="key-list">${missingCriticalKeys.slice(0, 10).join(', ')}${missingCriticalKeys.length > 10 ? '...' : ''}</div>
                            </div>
                        ` : '<p class="success">âœ… æ‰€æœ‰å…³é”®é”®éƒ½å·²ç¿»è¯‘</p>'}
                    </div>
                `;
            });
            
            statusDiv.innerHTML = html;
        }

        function testAllLanguages() {
            const languages = window.LANGUAGES;
            const results = {};
            
            // å®šä¹‰å…³é”®ç¿»è¯‘é”®
            const criticalKeys = [
                'room_title', 'room_subtitle', 'create_room_btn', 'join_room_btn',
                'room_name_label', 'room_password_label', 'max_members_label',
                'confirm_create_room', 'cancel_create_room', 'join_room_title',
                'room_code_label', 'join_password_label', 'confirm_join_room',
                'copy_room_code', 'your_name_label', 'members_online',
                'room_members_label', 'leave_room_btn', 'upload_files_to_room',
                'drag_files_here', 'files_shared_to_all', 'select_files_upload',
                'room_shared_files', 'files_count', 'no_shared_files', 'upload_hint'
            ];
            
            Object.keys(languages).forEach(langCode => {
                const lang = languages[langCode];
                const translations = lang.translations;
                
                const criticalKeysFound = criticalKeys.filter(key => translations[key]).length;
                const criticalCoverage = (criticalKeysFound / criticalKeys.length) * 100;
                
                results[langCode] = {
                    name: lang.name,
                    criticalCoverage: criticalCoverage,
                    totalKeys: Object.keys(translations).length,
                    missingKeys: criticalKeys.filter(key => !translations[key])
                };
            });
            
            console.log('All Languages Test Results:', results);
            
            // æ˜¾ç¤ºç»“æœæ‘˜è¦
            const statusDiv = document.getElementById('status');
            let summary = '<h3>Test Results Summary:</h3>';
            
            Object.keys(results).forEach(langCode => {
                const result = results[langCode];
                const status = result.criticalCoverage === 100 ? 'âœ…' : 
                              result.criticalCoverage >= 80 ? 'âš ï¸' : 'âŒ';
                
                summary += `
                    <p>${status} <strong>${result.name}</strong> (${langCode}): 
                    ${result.criticalCoverage.toFixed(1)}% critical coverage, 
                    ${result.totalKeys} total keys</p>
                `;
            });
            
            statusDiv.innerHTML = summary;
        }

        function updateStatus() {
            const statusDiv = document.getElementById('status');
            const currentLang = window.DROPSHARE_I18N.getCurrentLanguage();
            const langInfo = window.LANGUAGES[currentLang];
            
            let html = '<p><strong>å½“å‰è¯­è¨€:</strong> ' + currentLang + '</p>';
            html += '<p><strong>è¯­è¨€åç§°:</strong> ' + (langInfo ? langInfo.name : 'æœªçŸ¥') + '</p>';
            html += '<p><strong>ç¿»è¯‘é”®æ€»æ•°:</strong> ' + (langInfo ? Object.keys(langInfo.translations).length : 0) + '</p>';
            
            // æ£€æŸ¥å…³é”®ç¿»è¯‘é”®
            const keyChecks = [
                'room_title', 'room_subtitle', 'create_room_btn', 'join_room_btn',
                'room_name_label', 'room_password_label', 'max_members_label'
            ];
            
            html += '<p><strong>å…³é”®ç¿»è¯‘é”®æ£€æŸ¥:</strong></p>';
            keyChecks.forEach(key => {
                const translation = window.DROPSHARE_I18N.getText(key);
                const status = translation ? 'âœ…' : 'âŒ';
                html += `<p>${status} ${key}: ${translation || 'æœªæ‰¾åˆ°'}</p>`;
            });
            
            statusDiv.innerHTML = html;
        }

        // å¯åŠ¨æµ‹è¯•
        waitForLanguages();
    </script>
</body>
</html>




